<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.voracityrat.memehubbackend.mapper.PictureMapper">

    <resultMap id="BaseResultMap" type="com.voracityrat.memehubbackend.model.entity.Picture">
            <id property="id" column="id" />
            <result property="originUrl" column="origin_url" />
            <result property="picUrl" column="pic_url" />
            <result property="picName" column="pic_name" />
            <result property="introduction" column="introduction" />
            <result property="category" column="category" />
            <result property="tags" column="tags" />
            <result property="picSize" column="pic_size" />
            <result property="picWidth" column="pic_width" />
            <result property="picHeight" column="pic_height" />
            <result property="picScale" column="pic_scale" />
            <result property="picFormat" column="pic_format" />
            <result property="reviewStatus" column="review_status" />
            <result property="reviewMessage" column="review_message" />
            <result property="reviewerId" column="reviewer_id" />
            <result property="reviewTime" column="review_time" />
            <result property="userId" column="user_id" />
            <result property="createTime" column="create_time" />
            <result property="updateTime" column="update_time" />
            <result property="isDelete" column="is_delete" />
    </resultMap>

    <sql id="Base_Column_List">
        id,origin_url,pic_url,pic_name,introduction,category,tags,
        pic_size,pic_width,pic_height,pic_scale,pic_format,
        review_status,review_message,reviewer_id,review_time,user_id,
        create_time,update_time,is_delete
    </sql>
    <select id="getPicturePages" resultType="com.voracityrat.memehubbackend.model.entity.Picture">
        select * from picture
        <where>
            <if test="query.id!=null and query.id!=''">
                and id =#{query.id}
            </if>
            <if test="query.picUrl!=null and query.picUrl!=''">
                and picUrl =#{query.picUrl}
            </if>
            <if test="query.picName!=null and query.picName!=''">
                and pic_name Like CONCAT('%', #{query.picName}, '%')
            </if>
            <if test="query.introduction!=null and query.introduction!=''">
                and introduction Like CONCAT('%', #{query.introduction}, '%')
            </if>
            <if test="query.category!=null and query.category!=''">
                and category Like CONCAT('%', #{query.category}, '%')
            </if>
            <if test="query.tags!=null and !query.tags.isEmpty()">
                and
                <foreach collection="query.tags" item="tag" open="(" close=")" separator="and">
                    tags Like CONCAT('%', #{tag}, '%')
                </foreach>
            </if>
            <if test="query.reviewStatus!=null">
                and review_status =#{query.reviewStatus}
            </if>
            <if test="query.reviewMessage!=null and query.reviewMessage!=''">
                and review_message Like CONCAT('%', #{query.reviewMessage}, '%')
            </if>
            <if test="query.userId!=null and query.userId!=''">
                and user_id =#{query.userId}
            </if>
            <if test="query.startTime!=null and query.startTime!=''">
                and create_time &gt;= #{startTime}
            </if>
            <if test="query.endTime!=null and query.endTime!=''">
                and create_time &lt;= #{query.endTime}
            </if>
            <if test="query.searchText!=null and query.searchText!=''">
                and (
                    pic_name Like CONCAT('%', #{query.searchText}, '%') or
                introduction Like CONCAT('%', #{query.searchText}, '%') or
                    tags Like CONCAT('%', #{query.searchText}, '%') or
                review_message Like CONCAT('%', #{query.searchText}, '%')
                )
            </if>
            and is_delete = 0
        </where>
    </select>
</mapper>
